<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Map</title>
    <script src="https://cdn.staticfile.org/echarts/5.4.0/echarts.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div id="main" style="width: 800px; height: 600px;"></div>
    <input type="text" id="searchInput" placeholder="请输入城市名称">
    <script>
        // 初始化echarts地图
        var myChart = echarts.init(document.getElementById('main'));

        // 异步加载CSV数据
        $.get('data.csv', function (csvString) {
            // 将CSV数据解析成数组
            var data = parseCSV(csvString);
            // 处理数据并渲染地图
            renderMap(data);
        });

        // 解析CSV数据
        function parseCSV(csvString) {
            var lines = csvString.split('\n');
            var headers = lines[0].split(',');
            var result = [];
            for (var i = 1; i < lines.length; i++) {
                var obj = {};
                var currentLine = lines[i].split(',');
                for (var j = 0; j < headers.length; j++) {
                    obj[headers[j].trim()] = currentLine[j].trim();
                }
                result.push(obj);
            }
            return result;
        }

        // 渲染地图
        function renderMap(data) {
            // 假设已经获取到了每个城市的经纬度信息
            var cityCoordinates = {
                '日喀则': [88.886583, 29.267519],
                // 其他城市的经纬度信息
            };

            // 在地图上标注城市
            var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        var cityInfo = data.find(item => item.city === params.name);
                        return cityInfo ?
                            `${params.name}<br/>总辐射量：${cityInfo.total_radiation} kWh/m²<br/>利用小时：${cityInfo.utilization_hours}` :
                            `${params.name}<br/>暂无数据`;
                    }
                },
                series: [{
                    type: 'map',
                    map: 'china',
                    data: data.map(item => ({
                        name: item.city,
                        province: item.province
                    })),
                    emphasis: {
                        label: {
                            show: true
                        }
                    },
                    markPoint: {
                        symbolSize: 50,
                        data: data.map(item => ({
                            name: item.city,
                            value: cityCoordinates[item.city].concat([item.city, item.total_radiation, item.utilization_hours])
                        }))
                    }
                }]
            };

            myChart.setOption(option);

            // 模拟搜索功能
            document.getElementById('searchInput').addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    var searchCity = this.value.trim();
                    var foundCity = data.find(item => item.city.includes(searchCity));
                    if (foundCity) {
                        var coordinates = cityCoordinates[foundCity.city];
                        myChart.dispatchAction({
                            type: 'geoRoam',
                            center: coordinates,
                            zoom: 10
                        });
                    } else {
                        myChart.dispatchAction({
                            type: 'geoRoam',
                            center: [104.195397, 35.86166], // 中国中心点
                            zoom: 1
                        });
                    }
                }
            });
        }
    </script>
</body>
</html>
