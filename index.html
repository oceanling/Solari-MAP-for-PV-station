<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solar Map for PV Station</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/map.js"></script>
    <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>
</head>
<body>
    <div id="container" style="width: 100%; height: 600px;"></div>
    <script>
        // 读取 CSV 文件并处理数据
        $.get('data.csv', function(data) {
            const lines = data.split('\n');
            const csvData = [];

            // 解析 CSV 文件
            lines.forEach(line => {
                const [city, total_radiation, utilization_hours] = line.split(',');
                csvData.push({ city, total_radiation: parseFloat(total_radiation), utilization_hours: parseFloat(utilization_hours) });
            });

            // 定义城市坐标数据（使用一些示例数据，需要根据实际情况更新）
            const cityCoordinates = {
                '日喀则': [88.880583, 29.267634],
                '阿里': [80.105498, 32.501111],
                '拉萨': [91.117212, 29.646923]
            };

            // 准备地图数据
            const mapData = csvData.map(item => {
                const coordinates = cityCoordinates[item.city];
                if (coordinates) {
                    return {
                        name: item.city,
                        lat: coordinates[1],
                        lon: coordinates[0],
                        utilization_hours: item.utilization_hours
                    };
                }
            }).filter(item => item);

            // 初始化地图
            Highcharts.mapChart('container', {
                chart: {
                    map: 'custom/world'
                },
                title: {
                    text: 'Solar Utilization Hours in Various Cities'
                },
                mapNavigation: {
                    enabled: true,
                    enableDoubleClickZoomTo: true
                },
                tooltip: {
                    pointFormat: '{point.name}: {point.utilization_hours} hours'
                },
                series: [{
                    name: 'Basemap',
                    mapData: Highcharts.maps['custom/world'],
                    borderColor: '#A0A0A0',
                    nullColor: 'rgba(200, 200, 200, 0.3)',
                    showInLegend: false
                }, {
                    type: 'mappoint',
                    name: 'Cities',
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}'
                    },
                    data: mapData
                }]
            });
        });
    </script>
</body>
</html>
