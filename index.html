<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Map</title>
    <style>
        #main {
            width: 100%;
            height: 600px;
            margin: 0 auto;
        }
        #searchInput {
            margin: 10px;
            padding: 5px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <div id="main"></div>
    <input type="text" id="searchInput" placeholder="输入城市名进行搜索">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var chart = echarts.init(document.getElementById('main'));

            // Fetch data from CSV (you need to replace 'data.csv' with your actual CSV file path)
            fetch('data.csv')
                .then(response => response.text())
                .then(data => {
                    var lines = data.trim().split('\n');
                    var headers = lines[0].split(',');
                    var cityData = [];
                    for (var i = 1; i < lines.length; i++) {
                        var values = lines[i].split(',');
                        var city = values[0];
                        var totalRadiation = parseInt(values[1]);
                        var utilizationHours = parseInt(values[2]);
                        cityData.push({
                            city: city,
                            totalRadiation: totalRadiation,
                            utilizationHours: utilizationHours
                        });
                    }
                    
                    drawMap(cityData);
                })
                .catch(error => console.error('Error fetching data:', error));

            var searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                var searchQuery = this.value.trim();
                if (searchQuery === '') {
                    resetMap();
                } else {
                    var matchedCity = findMatchingCity(searchQuery);
                    if (matchedCity) {
                        locateCity(matchedCity);
                    } else {
                        locateProvince(searchQuery);
                    }
                }
            });

            function findMatchingCity(query) {
                query = query.toLowerCase();
                for (var i = 0; i < cityData.length; i++) {
                    if (cityData[i].city.toLowerCase().includes(query)) {
                        return cityData[i];
                    }
                }
                return null;
            }

            function drawMap(cityData) {
                var option = {
                    series: [{
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        data: cityData.map(city => {
                            return {
                                name: city.city,
                                value: [getRandomLongitude(), getRandomLatitude()], // Replace with actual coordinates
                                totalRadiation: city.totalRadiation,
                                utilizationHours: city.utilizationHours
                            };
                        }),
                        symbolSize: 10,
                        label: {
                            show: true,
                            formatter: '{b}'
                        },
                        itemStyle: {
                            color: 'blue'
                        }
                    }],
                    geo: {
                        map: 'china',
                        roam: true
                    }
                };
                chart.setOption(option);

                chart.on('click', function(params) {
                    var cityInfo = params.data;
                    if (cityInfo && cityInfo.name) {
                        alert(`城市：${cityInfo.name}\n总辐射量：${cityInfo.totalRadiation} kWh/m²\n利用小时：${cityInfo.utilizationHours}`);
                    }
                });
            }

            function resetMap() {
                var option = {
                    series: [{
                        data: []
                    }]
                };
                chart.setOption(option);
            }

            function locateCity(city) {
                // Implement city locating based on actual coordinates
                // For demonstration purpose, use random coordinates
                var coordinates = [getRandomLongitude(), getRandomLatitude()];
                chart.setOption({
                    geo: {
                        center: coordinates,
                        zoom: 5
                    }
                });
            }

            function locateProvince(province) {
                // Implement province locating based on actual coordinates
                // For demonstration purpose, use random coordinates
                var coordinates = [getRandomLongitude(), getRandomLatitude()];
                chart.setOption({
                    geo: {
                        center: coordinates,
                        zoom: 4
                    }
                });
            }

            function getRandomLongitude() {
                // Generate random longitude (for demo purpose)
                return 100 + Math.random() * 30; // Replace with actual data
            }

            function getRandomLatitude() {
                // Generate random latitude (for demo purpose)
                return 20 + Math.random() * 20; // Replace with actual data
            }
        });
    </script>
</body>
</html>
